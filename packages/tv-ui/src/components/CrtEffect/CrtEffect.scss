.CrtEffect {  
  --enable-transition: 1000ms;

  &,
  > canvas,
  > .content,
  > .background,
  &::before,
  &::after {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
  }
  
  > .text,
  > .content {
    transition: opacity var(--enable-transition) ease 0ms;
  }

  // TV frame
  &::after {
    background-image: url('./crt-frame.png');
    background-repeat: no-repeat;
    background-size: 100% 100%;
    z-index: 3;
    pointer-events: none;
    content: "";
    background-position: center;
    transition: background-size var(--enable-transition) ease 0ms;
  }

  &.disabled {
    > canvas,
    > .text,
    > .background {
      display: none;
    }
    &::after {
      background-size: 110% 110%;
    }
  }
  
  &:not(.disabled) {
    overflow: hidden;

    // Background when TV is off
    > .background {
      background: transparent
        linear-gradient(to bottom, #85908c 0%, #323431 100%)
        repeat
        scroll
        0
        0;
      content: "";
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
  
    // Pixel grid
    &::before {
      --screen-background: rgba(18, 16, 16);
      content: " ";
      background: linear-gradient(
          color-mix(
            in srgb,
            var(--screen-background),
            transparent 100%
          ) 50%,
          color-mix(
            in srgb,
            color-mix(in srgb, var(--screen-background), black 10%),
            transparent 75%
          ) 50%
        ),
        linear-gradient(
          90deg,
          rgb(255 0 0 / 6%),
          rgb(0 255 0 / 2%),
          rgb(0 0 255 / 6%),
        );
      z-index: 2;
      background-size: 100% 2px, 3px 100%;
      pointer-events: none;
    }

    > canvas {
      height: 100vh;
      overflow: hidden;
      width: 100vw;
      z-index: 2;
      transform: scale(0, 0);
      background: transparent
        linear-gradient(to bottom, #85908c 0%, #323431 100%)
        repeat
        scroll
        0
        0;
      position: relative;
      pointer-events: none;
    }
  
    > .content {
      animation-composition: add;
      filter: blur(1px);
      animation: glitch-jerk-up-small 100ms infinite;
      z-index: 1;
    }
  
    &.tv-on > canvas {
      animation: 3000ms linear var(--enable-transition) normal forwards 1 running turn-on, 3000ms linear var(--enable-transition) normal forwards 1 running turn-on-snow;
    }
    &.tv-turning-off > canvas,
    &.tv-turning-off > .content {
      animation: 750ms
        cubic-bezier(0.230, 1.000, 0.320, 1.000)
        0ms
        normal
        forwards
        1
        running
        turn-off;
    }
  
    $delay: 2000ms;
  
    .text {
      opacity: 1;
      color: lime;
      content: "AV-1";
      opacity: 0;
      filter: blur(0.5px);
      font-family: Sys;
      font-size: min(6vmin, 3.5em);
      left: max(5%, 1.5em);
      position: absolute;
      text-shadow: 0 0 3px lime;
      top: 10%;
      z-index: 5;
      transform: skewY(-1.5deg);
      animation-composition: add;
  
      span {
        filter: blur(1px);
        animation: blur 30ms infinite, glitch-jerk-right-small 50ms infinite;
        white-space: nowrap;
        
        &:not(:first-child) {
          position: absolute;
          top: 0;
          left: 0;
        }
        &:nth-child(1) {
          color: red;
          margin-left: -2px;
          filter: blur(2px);
          animation: glitch-jerk-up-small 1s infinite;
        }
        &:nth-child(2) {
          color: lime;
          margin-left: 2px;
          filter: blur(2px);
          animation: glitch-jerk-left 1s infinite;
        }
        &:nth-child(3) {
          color: blue;
          position: 20px 0;
          filter: blur(1px);
          animation: glitch-jerk-right 1s infinite;
        }
        &:nth-child(4) {
          color: #fff;
          filter: blur(1px);
          text-shadow: 0 0 50px rgba(255, 255, 255, 0.4);
        }
        &:nth-child(5) {
          color: rgba(255, 255, 255, 0.1);
          filter: blur(15px);
        }
      }
    }

    > .text,
    > .content {
      opacity: 0;
    }
  
    &.tv-on {
      > .text,
      > .content {
        animation: 5s ease calc(var(--enable-transition) + 1050ms) normal none infinite running glitch-periodic-skew, 300ms linear calc(var(--enable-transition) + 750ms) normal forwards 1 running turn-on;
      }
    }
  
    @keyframes turn-on {
      0% {
        transform: scale(1, 0.8) translate3d(0, 0, 0);
        filter: brightness(4);
        opacity: 1;
      }
      3.5% {
        transform: scale(1, 0.8) translate3d(0, 100%, 0);
      }
  
      3.6% {
        transform: scale(1, 0.8) translate3d(0, -100%, 0);
        opacity: 1;
      }
  
      9% {
        transform: scale(1.3, 0.6) translate3d(0, 100%, 0);
        filter: brightness(4);
        opacity: 0;
      }
  
      11% {
        transform: scale(1, 1) translate3d(0, 0, 0);
        filter: contrast(0) brightness(0);
        opacity: 0;
      }
  
      100% {
        transform: scale(1, 1) translate3d(0, 0, 0);
        filter: contrast(1) brightness(1.2) saturate(1.3);
        opacity: 1;
      }
    }
    @keyframes turn-on-snow {
      0% {
        opacity: 1;
      }
      
      11% {
        opacity: 1;
        mix-blend-mode: initial;
      }
      
      12% {
        opacity: 0;
        mix-blend-mode: soft-light;
      }
  
      100% {
        opacity: 0.1;
      }
    }
    @keyframes turn-off {
      0% {
        transform: scale(1, 1);
        filter: brightness(1);
      }
      40% {
        transform: scale(1, 0.005);
        filter: brightness(100);
      }
      70% {
        transform: scale(1, 0.005);
      }
      90% {
        transform: scale(0.005, 0.005);
      }
      100% {
        transform: scale(0, 0);
      }
    }
    @keyframes blur {
      0% {
        filter: blur(1px);
        opacity: 0.8;
      }
      50% {
        filter: blur(1px);
        opacity: 1;
      }
      100% {
        filter: blur(1px);
        opacity: 0.8;
      }
    }
    @keyframes glitch-jerk-right {
      0% {
        transform: translateX(0);
      }
      30% {
        transform: translateX(0);
      }
      31% {
        transform: translateX(10px);
      }
      32% {
        transform: translateX(0);
      }
      98% {
        transform: translateX(0);
      }
      100% {
        transform: translateX(10px);
      }
    }
    @keyframes glitch-jerk-right-small {
      50% {
        transform: translateX(1px);
      }
      51% {
        transform: translateX(0);
      }
    }
    @keyframes glitch-jerk-left {
      0% {
        transform: translateX(0);
      }
      30% {
        transform: translateX(0);
      }
      31% {
        transform: translateX(-10px);
      }
      32% {
        transform: translateX(0);
      }
      98% {
        transform: translateX(0);
      }
      100% {
        transform: translateX(-10px);
      }
    }
    @keyframes glitch-jerk-up-small {
      0% {
        transform: translateY(1px);
      }
      100% {
        transform: translateY(0);
      }
    }
    @keyframes glitch-periodic-skew {
      30% {
      }
      40% {
        opacity: 1;
        transform: scale(1, 1) skew(0, 0);
      }
      41% {
        opacity: 0.8;
        transform: scale(1, 1.05) skew(80deg, 0);
      }
      42% {
        opacity: 0.8;
        transform: scale(1, 1.05) skew(-50deg, 0);
      }
      43% {
        opacity: 1;
        transform: scale(1, 1) skew(0, 0);
      }
      65% {
      }
    }
  }
  
  @font-face {
    src: url(https://s3-us-west-2.amazonaws.com/s.cdpn.io/86186/sys.ttf)
      format('truetype');
    font-family: 'Sys';
  }
}